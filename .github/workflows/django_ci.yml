# name: Django CI

# on:
#   push:
#     branches: ["main"]
#   pull_request:
#     branches: ["main"]

# jobs:
#   test:
#     runs-on: ubuntu-latest

#     steps:
#     - name: Checkout source code
#       uses: actions/checkout@v4

#     - name: Setup Python
#       uses: actions/setup-python@v5
#       with:
#         python-version: "3.10"

#     - name: Install dependencies
#       run: |
#         python -m pip install --upgrade pip
#         pip install -r requirements.txt

#     - name: Run migrations
#       run: |
#         python manage.py migrate

#     - name: Run tests
#       run: |
#         python manage.py test



# name: Django CI

# on:
#   push:
#     branches: ["main"]
#   pull_request:
#     branches: ["main"]

# jobs:
#   test:
#     runs-on: ubuntu-latest

#     services:
#       mysql:
#         image: mysql:8.0
#         env:
#           MYSQL_DATABASE: test_db
#           MYSQL_USER: testuser
#           MYSQL_PASSWORD: testpass
#           MYSQL_ROOT_PASSWORD: rootpass
#         ports:
#           - 3306:3306
#         options: >-
#           --health-cmd="mysqladmin ping -h localhost -ptestpass"
#           --health-interval=10s
#           --health-timeout=5s
#           --health-retries=5

#     steps:
#     - uses: actions/checkout@v4

#     - name: Setup Python
#       uses: actions/setup-python@v5
#       with:
#         python-version: "3.10"

#     - name: Install dependencies
#       run: |
#         python -m pip install --upgrade pip
#         pip install -r requirements.txt

#     - name: Run migrations
#       env:
#         DB_NAME: test_db
#         DB_USER: testuser
#         DB_PASSWORD: testpass
#         DB_HOST: 127.0.0.1
#         DB_PORT: 3306
#       run: |
#         python manage.py migrate

#     - name: Run tests
#       env:
#         DB_NAME: test_db
#         DB_USER: testuser
#         DB_PASSWORD: testpass
#         DB_HOST: 127.0.0.1
#         DB_PORT: 3306
#       run: |
#         python manage.py test

name: Django CI

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Setup Python
      uses: actions/setup-python@v5
      with:
        python-version: "3.10"

    - name: Install system dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libcairo2-dev pkg-config python3-dev
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run migrations
      run: |
        python manage.py migrate

    - name: Run tests
      run: |
        python manage.py test


